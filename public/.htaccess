<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        # Disable directory listing and MultiViews
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On
    RewriteBase /

    # Handle Authorization Header
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Redirect Trailing Slashes If Not A Folder
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Send Requests To Front Controller
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>

# ==============================
# SECURITY HEADERS
# ==============================
<IfModule mod_headers.c>
    # Prevent MIME sniffing
    Header always set X-Content-Type-Options "nosniff"

    # Prevent clickjacking
    Header always set X-Frame-Options "SAMEORIGIN"

    # Prevent reflected XSS attacks
    Header always set X-XSS-Protection "1; mode=block"

    # Restrict content sources (optional CSP)
    Header set Content-Security-Policy "default-src 'self' data: https: 'unsafe-inline' 'unsafe-eval';"

    # Disable caching of sensitive pages
    Header always set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
    Header always set Pragma "no-cache"
    Header always set Expires "0"

    # Force HTTPS (only if using SSL)
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS
</IfModule>

# ==============================
# BLOCK SENSITIVE FILES
# ==============================
<FilesMatch "(^\.|composer\.(json|lock)|artisan|server\.php|.env|.htaccess|.htpasswd|storage|vendor|config)">
    Require all denied
</FilesMatch>

# Disable PHP execution in storage or uploads folders
<Directory "/path/to/laravel/storage">
    <FilesMatch "\.php$">
        Require all denied
    </FilesMatch>
</Directory>

# Disable directory browsing
Options -Indexes

# ==============================
# ADDITIONAL SECURITY
# ==============================
# Prevent image/script upload attacks
<FilesMatch "\.(php|php[0-9]|phtml|phar)$">
    Require all denied
</FilesMatch>

# Deny access to backup or source files
<FilesMatch "\.(bak|config|sql|fla|psd|ini|log|sh|inc|swp|dist)$">
    Require all denied
</FilesMatch>

# Protect against ETag information leaks
FileETag None
